# ベンダーQBR評価分析システム 仕様書

## 1. プロジェクト概要

### 1.1 目的
複数ベンダーの保守運用サービスに対するユーザー評価を収集・分析し、客観的かつ公平な評価に基づいてベンダーの優劣を判定する。

### 1.2 対象
- **ベンダー数**: 4社（A社、B社、C社、D社）
- **担当領域**: 各社異なるアプリケーション領域の保守運用
- **評価者数**: 100名以上
- **評価期間**: 四半期ごと（QBR: Quarterly Business Review）

<br>

## 2. 評価構造

### 2.1 評価階層

```
レベル1（大分類）: 4項目
├─ パフォーマンス
│  └─ レベル2（詳細項目）: 複数項目
├─ 技術レベル
│  └─ レベル2（詳細項目）: 複数項目
├─ ビジネス理解
│  └─ レベル2（詳細項目）: 複数項目
└─ 改善提案
   └─ レベル2（詳細項目）: 複数項目
```

### 2.2 評価スケール
- **5段階評価**: 1（最低）〜 5（最高）
- **評価方法**: リッカート尺度

### 2.3 大分類の詳細定義

#### パフォーマンス（Performance）
サービス提供の品質と応答性を評価
- 詳細項目例:
  - インシデント対応速度
  - SLA達成率
  - 問題解決の確実性
  - コミュニケーションの迅速性
  - 可用性の維持

#### 技術レベル（Technical Capability）
技術的な専門性と能力を評価
- 詳細項目例:
  - 技術的専門知識
  - トラブルシューティング能力
  - 新技術への対応力
  - ドキュメント品質
  - 技術的提案力

#### ビジネス理解（Business Understanding）
ビジネスへの理解と貢献を評価
- 詳細項目例:
  - 業務プロセス理解度
  - ビジネス影響の考慮
  - 優先順位付けの適切性
  - ステークホルダー対応
  - コスト意識

#### 改善提案（Improvement Proposals）
継続的改善と提案力を評価
- 詳細項目例:
  - 改善提案の質
  - 改善提案の頻度
  - プロアクティブな姿勢
  - イノベーション
  - 長期的視点

<br>

## 3. データ構造

### 3.1 収集データの形式

#### 回答データテーブル

| 列名 | データ型 | 説明 | 例 | 必須 |
|------|---------|------|-----|------|
| response_id | INTEGER | 回答レコードの一意識別子 | 1 | ✓ |
| respondent_id | INTEGER | 回答者の一意識別子 | 101 | ✓ |
| vendor_id | VARCHAR | 評価対象ベンダーID | A | ✓ |
| vendor_name | VARCHAR | ベンダー名 | A社 | ✓ |
| timestamp | DATETIME | 回答日時 | 2024-10-15 14:30:00 | ✓ |
| department | VARCHAR | 回答者所属部門ID | business | ✓ |
| department_ja | VARCHAR | 所属部門名（日本語） | 業務部門 | ✓ |
| role | VARCHAR | 回答者役職ID | manager | ✓ |
| role_ja | VARCHAR | 役職名（日本語） | マネージャー | ✓ |
| usage_frequency | VARCHAR | サービス利用頻度ID | high | ✓ |
| usage_frequency_ja | VARCHAR | 利用頻度（日本語） | 高頻度 | ✓ |
| incident_experience | BOOLEAN | インシデント経験有無 | true | ✓ |
| **performance_incident_response_speed** | INTEGER | パフォーマンス：インシデント対応速度 | 4 | ✓ |
| **performance_sla_achievement** | INTEGER | パフォーマンス：SLA達成率 | 5 | ✓ |
| **performance_problem_resolution** | INTEGER | パフォーマンス：問題解決の確実性 | 4 | ✓ |
| **performance_communication_speed** | INTEGER | パフォーマンス：コミュニケーションの迅速性 | 3 | ✓ |
| **performance_availability_maintenance** | INTEGER | パフォーマンス：可用性の維持 | 4 | ✓ |
| **technical_expertise** | INTEGER | 技術レベル：技術的専門知識 | 4 | ✓ |
| **technical_troubleshooting** | INTEGER | 技術レベル：トラブルシューティング能力 | 5 | ✓ |
| **technical_new_tech_adaptation** | INTEGER | 技術レベル：新技術への対応力 | 3 | ✓ |
| **technical_documentation_quality** | INTEGER | 技術レベル：ドキュメント品質 | 4 | ✓ |
| **technical_proposal** | INTEGER | 技術レベル：技術的提案力 | 4 | ✓ |
| **business_process_understanding** | INTEGER | ビジネス理解：業務プロセス理解度 | 5 | ✓ |
| **business_impact_consideration** | INTEGER | ビジネス理解：ビジネス影響の考慮 | 4 | ✓ |
| **business_prioritization** | INTEGER | ビジネス理解：優先順位付けの適切性 | 4 | ✓ |
| **business_stakeholder_management** | INTEGER | ビジネス理解：ステークホルダー対応 | 3 | ✓ |
| **business_cost_awareness** | INTEGER | ビジネス理解：コスト意識 | 4 | ✓ |
| **improvement_proposal_quality** | INTEGER | 改善提案：改善提案の質 | 3 | ✓ |
| **improvement_proposal_frequency** | INTEGER | 改善提案：改善提案の頻度 | 3 | ✓ |
| **improvement_proactive_attitude** | INTEGER | 改善提案：プロアクティブな姿勢 | 4 | ✓ |
| **improvement_innovation** | INTEGER | 改善提案：イノベーション | 3 | ✓ |
| **improvement_long_term_perspective** | INTEGER | 改善提案：長期的視点 | 3 | ✓ |
| comment | TEXT | 自由記述コメント | 対応は迅速でした... | ✗ |
---

<br>

## 4. データクレンジング

### 4.1 除外基準

#### 回答レベルでの除外
1. **すべて同一評価**: 全項目が同じスコア（例: すべて5）
2. **評価ベンダー数不足**: 1社のみ評価（相対評価不可）
3. **未回答率**: 50%以上の項目が未回答
4. **異常な回答時間**: 極端に短い回答時間（データがあれば）

#### 項目レベルでの処理
- **欠損値**: 以下の優先順位で処理
  1. その回答者の他項目平均で補完（同一大分類内）
  2. 補完不可の場合は当該項目を除外

### 4.2 データ検証チェック
- スコア範囲チェック（1-5の範囲外がないか）
- ベンダーIDの整合性チェック
- 回答者IDの重複チェック
- タイムスタンプの妥当性チェック

<br>

## 5. 分析手法

### 5.1 回答者バイアス分析

#### 5.1.1 回答者プロファイリング
各回答者について以下を算出:

```
回答者平均スコア = Σ(全評価スコア) / 評価数
回答者標準偏差 = √(Σ(スコア - 平均)² / n)
極端値使用率 = (スコア1の数 + スコア5の数) / 全評価数
中央値使用率 = スコア3の数 / 全評価数
```

#### 5.1.2 異常パターン検出
- すべて同一スコア → 除外
- 標準偏差 = 0 → 除外
- 極端値使用率 > 80% → 要注意フラグ

### 5.2 スコア補正手法

#### 手法A: Z-score標準化【メイン手法】
```
標準化スコア = (元のスコア - 回答者平均) / 回答者標準偏差
```

**適用条件**:
- 回答者が2社以上を評価している
- 回答者標準偏差 > 0

**変換後の特性**:
- 平均: 0
- 標準偏差: 1
- 範囲: 通常 -3 〜 +3

#### 手法B: 相対順位化【検証用】
```
1. 各回答者が評価したベンダーに順位をつける（同点は平均順位）
2. 全回答者の順位を集計
3. ベンダーごとの平均順位を算出
```

**Borda Count方式**:
```
得点 = Σ(ベンダー数 - 順位 + 1)
例: 4社中2位 → 得点 = 4 - 2 + 1 = 3
```

#### 手法C: 中心化【参考用】
```
中心化スコア = 元のスコア - 回答者平均 + 全体平均
```

**適用**:
- 元の1-5スケールを維持したい場合
- 経営層への報告用

### 5.3 ベンダー総合評価

#### 5.3.1 大分類レベルの集計
各ベンダー×大分類で以下を算出:

```
平均スコア = Σ(詳細項目スコア) / 詳細項目数
標準偏差 = √(Σ(スコア - 平均)² / n)
95%信頼区間 = 平均 ± (1.96 × 標準誤差)
  ※標準誤差 = 標準偏差 / √n
```

#### 5.3.2 重み付け総合スコア
```
総合スコア = Σ(大分類スコア × ウェイト)
```

**推奨ウェイト**:
- パフォーマンス: 35%
- 技術レベル: 30%
- ビジネス理解: 20%
- 改善提案: 15%

**調整可能**: 経営層と協議の上、変更可能

#### 5.3.3 複合評価スコア
```
最終評価スコア = 標準化スコア × 0.5 
                + 順位スコア × 0.3 
                + 生スコア × 0.2
```

**信頼性調整**:
```
調整後スコア = 最終評価スコア × 信頼性係数
信頼性係数 = min(1.0, √(評価者数 / 20))
  ※評価者数20名未満の場合にペナルティ
```

### 5.4 統計的検定

#### 5.4.1 分散分析（ANOVA）
```
帰無仮説H0: 全ベンダーの平均スコアは等しい
対立仮説H1: 少なくとも1つのベンダーが異なる

F統計量 = 群間分散 / 群内分散
有意水準: α = 0.05
```

#### 5.4.2 多重比較（Tukey HSD検定）
ANOVAで有意差が出た場合、どのペア間に差があるか検証:

```
ペアごとのp値を算出
有意水準調整: Bonferroni補正またはTukey法
```

#### 5.4.3 効果量（Cohen's d）
```
d = (平均1 - 平均2) / 統合標準偏差

解釈:
- |d| < 0.2: 効果小
- 0.2 ≤ |d| < 0.5: 効果中
- |d| ≥ 0.5: 効果大
```

### 5.5 セグメント分析

#### 5.5.1 評価者群別分析
評価者を以下で分類:

```
- 厳格評価者: 平均スコア < 3.0
- 標準評価者: 3.0 ≤ 平均スコア ≤ 4.0
- 寛容評価者: 平均スコア > 4.0
```

各群内でのベンダーランキングを算出

#### 5.5.2 属性別分析
- 部門別（業務部門 vs IT部門）
- 利用頻度別（高/中/低）
- インシデント経験有無別

各セグメントでベンダースコアを比較

#### 5.5.3 クロス集計
```
カイ二乗検定:
属性とベンダー選好に関連があるか検証
```

<br>

## 6. 可視化仕様

### 6.1 グラフ一覧と用途

#### 必須グラフ（最優先）

##### G1: レーダーチャート（4大分類比較）
- **軸**: 4大分類（パフォーマンス、技術レベル、ビジネス理解、改善提案）
- **プロット**: 4社のベンダー（異なる色）
- **データ**: 標準化スコア平均
- **サイズ**: 正方形、600×600px推奨
- **色**: 
  - A社: #1f77b4 (青)
  - B社: #ff7f0e (橙)
  - C社: #2ca02c (緑)
  - D社: #d62728 (赤)

##### G2: ヒートマップ（詳細項目）
- **行**: 詳細項目（15-20項目）
- **列**: 4社のベンダー
- **色**: 
  - 低スコア: #d73027 (赤)
  - 中スコア: #fee08b (黄)
  - 高スコア: #1a9850 (緑)
- **数値表示**: 各セルにスコア表示（小数点1桁）
- **サイズ**: 横800×縦600px推奨

##### G3: 箱ひげ図＋有意差マーク
- **X軸**: ベンダー（A, B, C, D）
- **Y軸**: 標準化スコア
- **要素**: 
  - 箱: Q1-Q3（IQR）
  - 線: 中央値
  - ひげ: 1.5×IQR
  - 外れ値: 個別プロット
- **有意差マーク**: 
  - ***: p < 0.001
  - **: p < 0.01
  - *: p < 0.05
  - 線で結ぶ
- **サイズ**: 横800×縦600px推奨

##### G4: ポジショニングマップ
- **X軸**: パフォーマンススコア（現在の実力）
- **Y軸**: 改善提案スコア（将来性）
- **プロット**: 4社のベンダー（バブル）
- **バブルサイズ**: 評価者数
- **基準線**: X=平均、Y=平均で4象限分割
- **ラベル**: 各ベンダー名表示
- **サイズ**: 正方形、600×600px推奨

#### 補助グラフ

##### G5: ダンベルチャート（補正前後比較）
- **Y軸**: ベンダー名
- **X軸**: スコア
- **プロット**: 
  - ●: 生スコア平均
  - ○: 標準化スコア平均（再スケール: 1-5）
  - 線で結ぶ

##### G6: 積み上げ棒グラフ（重み付け内訳）
- **X軸**: ベンダー
- **Y軸**: 加重合計スコア
- **色分け**: 4大分類の寄与度
- **凡例**: ウェイト(%)表示

##### G7: 回答者傾向散布図
- **X軸**: 回答者平均スコア
- **Y軸**: 回答者標準偏差
- **色**: 極端値使用率（グラデーション）
- **サイズ**: 評価ベンダー数
- **基準線**: 
  - X=3.0（中立）
  - Y=0.5（メリハリの基準）

##### G8: 順位分布（積み上げ棒グラフ100%）
- **X軸**: ベンダー
- **Y軸**: 割合(%)
- **色分け**: 1位/2位/3位/4位
- **色**: 
  - 1位: 金色
  - 2位: 銀色
  - 3位: 銅色
  - 4位: グレー

##### G9: グループ化棒グラフ（詳細項目）
- 大分類ごとに1グラフ作成（計4グラフ）
- **X軸**: 詳細項目名
- **Y軸**: スコア
- **棒**: 4社のベンダー（並列）

##### G10: ファセットグラフ（評価者群別）
- 3つの小レーダーチャートを横並び
  - 厳格評価者群
  - 標準評価者群
  - 寛容評価者群
- 各グラフに4社表示

### 6.2 色とデザイン規約

#### カラーパレット
```
ベンダー色:
- A社: #1f77b4 (青系)
- B社: #ff7f0e (橙系)
- C社: #2ca02c (緑系)
- D社: #d62728 (赤系)

スコアグラデーション:
- 低 (1.0-2.5): #d73027
- 中低 (2.5-3.5): #fee08b
- 中高 (3.5-4.5): #a6d96a
- 高 (4.5-5.0): #1a9850

背景・補助:
- 背景: #ffffff
- グリッド: #e0e0e0
- テキスト: #333333
```

#### フォント
```
- タイトル: 16pt, Bold
- 軸ラベル: 12pt, Regular
- 凡例: 10pt, Regular
- 数値: 10pt, Regular
```

#### グラフ共通設定
```python
{
    "figure.figsize": (10, 6),
    "figure.dpi": 100,
    "axes.grid": True,
    "grid.alpha": 0.3,
    "axes.spines.top": False,
    "axes.spines.right": False,
    "font.family": "sans-serif",
    "font.sans-serif": ["Arial", "Helvetica"]
}
```

<br>

## 7. 出力仕様

### 7.1 分析結果サマリーテーブル

#### 総合評価テーブル
| ベンダー | 生スコア平均 | 標準化スコア | 順位平均 | 複合スコア | 総合順位 | 評価者数 | 信頼性係数 |
|---------|-------------|-------------|---------|-----------|---------|---------|-----------|
| A社 | 3.85 | +0.45 | 1.8 | 4.12 | 1 | 95 | 1.00 |
| B社 | 4.10 | +0.21 | 2.1 | 4.05 | 2 | 102 | 1.00 |
| C社 | 3.52 | -0.15 | 2.9 | 3.68 | 3 | 88 | 0.98 |
| D社 | 3.38 | -0.51 | 3.2 | 3.45 | 4 | 78 | 0.93 |

#### 大分類別スコアテーブル
| ベンダー | パフォーマンス | 技術レベル | ビジネス理解 | 改善提案 | 加重平均 |
|---------|---------------|-----------|------------|---------|---------|
| A社 | 4.2 (1) | 4.0 (2) | 3.8 (1) | 3.6 (2) | 4.0 |
| B社 | 4.0 (2) | 4.2 (1) | 3.5 (3) | 3.8 (1) | 3.9 |
| C社 | 3.5 (3) | 3.8 (3) | 3.6 (2) | 3.2 (3) | 3.6 |
| D社 | 3.2 (4) | 3.5 (4) | 3.3 (4) | 3.0 (4) | 3.3 |

※括弧内は順位

#### 統計的有意差テーブル
| ペア | パフォーマンス | 技術レベル | ビジネス理解 | 改善提案 | 総合 |
|------|--------------|-----------|------------|---------|------|
| A vs B | ns | * | ** | ns | * |
| A vs C | *** | ** | ns | *** | *** |
| A vs D | *** | *** | *** | *** | *** |
| B vs C | *** | ** | ns | *** | *** |
| B vs D | *** | *** | ** | *** | *** |
| C vs D | ** | * | * | * | ** |

記号: ***p<0.001, **p<0.01, *p<0.05, ns=有意差なし

<br>

### 7.2 ベンダー個別レポート

各ベンダーについて以下を出力:

```
=== ベンダーA社 詳細レポート ===

【総合評価】
順位: 1位 / 4社中
総合スコア: 4.12 / 5.0
評価者数: 95名

【強みTop3】
1. ビジネス理解 (3.8点) - 業務プロセス理解が特に高評価
2. パフォーマンス (4.2点) - インシデント対応速度が優秀
3. 技術レベル (4.0点) - トラブルシューティング能力が評価

【弱みTop3】
1. 改善提案 (3.6点) - プロアクティブな提案が不足
2. [詳細項目名] (3.4点)
3. [詳細項目名] (3.5点)

【セグメント別評価】
- 業務部門: 4.2点 (1位)
- IT部門: 4.0点 (2位)
- ヘビーユーザー: 4.3点 (1位)

【統計情報】
- 標準偏差: 0.85 (安定性: 高)
- 95%信頼区間: [4.0, 4.3]
- 1位獲得率: 45%

【改善推奨事項】
1. 改善提案の頻度と質を向上
2. ...
```

<br>

### 7.3 ファイル出力形式

#### CSVファイル
```
output/
├── summary_scores.csv              # 総合スコアサマリー
├── category_scores.csv             # 大分類別スコア
├── detailed_scores.csv             # 詳細項目別スコア
├── statistical_tests.csv           # 統計検定結果
├── segment_analysis.csv            # セグメント別分析
├── respondent_profile.csv          # 回答者プロファイル
└── raw_vs_adjusted_scores.csv      # 補正前後比較
```

#### グラフファイル
```
output/figures/
├── radar_chart_4categories.png
├── heatmap_detailed_items.png
├── boxplot_with_significance.png
├── positioning_map.png
├── dumbbell_chart.png
├── stacked_bar_weights.png
├── respondent_scatter.png
├── rank_distribution.png
├── grouped_bar_performance.png
├── grouped_bar_technical.png
├── grouped_bar_business.png
├── grouped_bar_improvement.png
└── facet_by_respondent_group.png
```

#### レポートファイル
```
output/reports/
├── executive_summary.pdf           # エグゼクティブサマリー
├── vendor_A_detail.pdf             # A社詳細レポート
├── vendor_B_detail.pdf
├── vendor_C_detail.pdf
├── vendor_D_detail.pdf
└── full_analysis_report.pdf        # 完全版分析レポート
```

