# IT人材需要計算プログラム

## 概要

このプログラムは、プロジェクトポートフォリオデータから**IT人材のスキル需要**を計算するツールです。

事業会社のIT組織における4つのケイパビリティ（能力）別に、プロジェクト規模・種別・技術領域を考慮した人材需要を算出します。

### 計算される4つのケイパビリティ

1. **ビジネスケイパビリティ** - ビジネス価値創出とステークホルダー連携
2. **デリバリケイパビリティ** - プロジェクト遂行・納品能力
3. **テクニカルケイパビリティ** - 技術的専門性・実装力
4. **リーダーシップケイパビリティ** - 組織・人材マネジメント

---

## 主な機能

- **2段階処理**によるスキル需要計算
  - **ステップ1**: プロジェクト分類処理（中間ファイル生成）
  - **ステップ2**: スキル需要計算（最終結果生成）
  
- **自動分類機能**
  - 投資金額からプロジェクト規模を推定（大規模/中規模/小規模/極小規模）
  - プロジェクト名から技術領域を判定（AI/ML、クラウド、DX/デジタル、従来型）
  - プロジェクト名からプロジェクト種別を判定（新規開発、導入、刷新、移行、その他）
  
- **柔軟なスキル構成比設定**
  - プロジェクト規模とプロジェクト種別の組み合わせごとに異なるスキル構成比を適用
  - YAML設定ファイルで簡単にカスタマイズ可能

- **キーワード定義の分離管理**
  - 分類に使用するキーワードをJSONファイルで管理
  - プログラムコードを変更せずにキーワードの追加・変更が可能

- **運用需要の計算**
  - 運用費から年間運用人月を計算
  - 月平均運用人員を算出

- **データバリデーション機能**
  - 入力データの品質チェック
  - 設定ファイルの整合性チェック

---

## 必要要件

- Python 3.8以上

## セットアップ

### 0. 仮想環境の作成（推奨）
```bash
# 仮想環境を作成
python3 -m venv venv

# 仮想環境を有効化（macOS/Linux）
source venv/bin/activate

# 仮想環境を有効化（Windows）
venv\Scripts\activate
```

### 1. 依存ライブラリのインストール

```bash
pip install -r requirements.txt
```

---

## ディレクトリ構成

```
project_root/
├── main.py                          # メインプログラム
├── config/
│   ├── calc_assumptions.yaml        # 設定ファイル（スキル構成比、計算パラメータ）
│   └── keywords.json                # キーワード定義（技術領域、プロジェクト種別）
├── modules/
│   ├── demand_calculator.py         # 需要計算クラス
│   └── data_validator.py            # データバリデーションクラス
├── CSV/                             # 入力CSVファイル格納フォルダ
│   └── *.csv                        # プロジェクトポートフォリオCSV
├── intermediate/                    # 中間ファイル格納フォルダ
│   └── classified_*.csv             # 分類結果CSV（自動生成）
└── out/                             # 最終出力ファイル格納フォルダ
    └── *.csv                        # スキル需要計算結果CSV（自動生成）
```

---

## 設定ファイル

### 1. calc_assumptions.yaml（YAML設定ファイル）

プロジェクト規模の判定基準、スキル構成比、計算パラメータを定義します。

**主な設定項目:**
- プロジェクト規模の判定基準（人月閾値）
- スキル構成比（規模×種別の組み合わせごと）
- 投資金額→人月変換パラメータ
- 運用需要計算パラメータ

詳細は「設定ファイル詳細」セクションを参照してください。

### 2. keywords.json（キーワード定義ファイル）

プロジェクト分類に使用するキーワードを定義します。

**構成:**
```json
{
  "tech_area_keywords": {
    "AI/ML": ["AI活用", "機械学習", "人工知能"],
    "クラウド": ["クラウド", "AWS", "Azure", "GCP"],
    "DX/デジタル": ["DX推進", "デジタル", "デジタル化"],
    "従来型": ["default"]
  },
  "project_type_keywords": {
    "新規開発": ["開発", "構築"],
    "導入": ["導入"],
    "刷新": ["刷新", "リプレース"],
    "移行": ["移行"],
    "その他": ["default"]
  }
}
```

**キーワードの追加方法:**

1. `config/keywords.json`をテキストエディタで開く
2. 該当するカテゴリの配列にキーワードを追加
3. JSON形式を保持（カンマ、ブラケットに注意）

**例: AI/MLにキーワード追加**
```json
"AI/ML": [
  "AI活用",
  "機械学習",
  "人工知能",
  "ディープラーニング"  ← 追加
]
```

詳細は`config/KEYWORDS_README.md`を参照してください。

---

## 入力CSVフォーマット

### 必須列

入力CSVファイルには以下の列が必要です:

| 列名 | データ型 | 説明 | 例 |
|------|---------|------|-----|
| `案件ID` | 文字列 | プロジェクトの一意識別子 | `PRJ-001` |
| `案件名` | 文字列 | プロジェクト名（分類判定に使用） | `AI活用による需要予測システム開発` |
| `活動開始月` | 日付 | プロジェクト活動開始月 | `2024-10-01` |
| `活動終了月` | 日付 | プロジェクト活動終了月 | `2025-03-31` |
| `初期投資金額` | 数値 | 初期投資額（千円単位） | `120000` |
| `運用費` | 数値 | 年間運用費（千円単位） | `24000` |
| `システム利用開始時期` | 日付 | システム稼働開始日 | `2025-04-01` |

> **注**: `活動開始月`と`活動終了月`が両方存在する場合、活動期間月数が計算されます。存在しない場合はデフォルト12ヶ月として扱われます。

---
<br>

## 出力CSVフォーマット

### 中間ファイル（intermediate/classified_*.csv）

プロジェクトの分類情報が追加されます:

| 列名 | 説明 |
|------|------|
| 元のデータ列 | 入力CSVのすべての列 |
| `プロジェクト規模` | 大規模/中規模/小規模/極小規模 |
| `プロジェクト種別` | 新規開発、導入、刷新、移行、その他 |
| `技術領域` | AI/ML、クラウド、DX/デジタル、従来型 |

### 最終出力ファイル（out/*.csv）

スキル需要の計算結果が追加されます:

| 列名 | 説明 |
|------|------|
| `開発_ビジネスケイパビリティ(人月)` | 開発フェーズのビジネスケイパビリティ需要 |
| `開発_デリバリケイパビリティ(人月)` | 開発フェーズのデリバリケイパビリティ需要 |
| `開発_テクニカルケイパビリティ(人月)` | 開発フェーズのテクニカルケイパビリティ需要 |
| `開発_リーダーシップケイパビリティ(人月)` | 開発フェーズのリーダーシップケイパビリティ需要 |
| `運用_ビジネスケイパビリティ(人月)` | 運用フェーズのビジネスケイパビリティ需要 |
| `運用_デリバリケイパビリティ(人月)` | 運用フェーズのデリバリケイパビリティ需要 |
| `運用_テクニカルケイパビリティ(人月)` | 運用フェーズのテクニカルケイパビリティ需要 |
| `運用_リーダーシップケイパビリティ(人月)` | 運用フェーズのリーダーシップケイパビリティ需要 |

---
<br>

## 使用方法

### 1. 入力ファイルの準備

`CSV/`フォルダにプロジェクトポートフォリオのCSVファイルを配置します。

```bash
CSV/
├── project_portfolio_2024.csv
└── project_portfolio_2025.csv
```

### 2. プログラムの実行

```bash
python3 main.py
```

実行すると、ステップ選択画面が表示されます:

```
実行するステップを選択してください:
  1: ステップ1のみ（分類処理）
  2: ステップ2のみ（需要計算）
  Enter: 両方実行（デフォルト）

選択 [Enter]: 
```

#### 実行モードの選択

- **Enter（デフォルト）**: ステップ1→2を連続実行（通常の使い方）
- **1を入力**: ステップ1のみ実行（分類処理）
  - 用途: 分類精度の確認、キーワード設定の微調整
  - 中間ファイルを確認してから次のステップを決定
- **2を入力**: ステップ2のみ実行（需要計算）
  - 用途: 中間ファイルを手動修正した後の再計算
  - intermediateフォルダのCSVを編集してから実行

### 3. 処理の流れ

プログラムは以下の2段階で処理を実行します:

#### ステップ1: プロジェクト分類処理

- CSV/フォルダ内の全CSVファイルを読み込み
- 各プロジェクトを分類（規模、技術領域、種別）
- 分類結果を`intermediate/classified_*.csv`に保存

**ステップ1のみ実行した場合の活用例:**

1. 中間ファイル（intermediate/classified_*.csv）を開いて分類結果を確認
2. 分類精度が低い場合は`config/keywords.json`のキーワードを調整
3. または`calc_assumptions.yaml`の閾値を調整
4. 再度ステップ1を実行して分類精度を向上
5. 満足できる分類結果が得られたらステップ2へ進む

#### ステップ2: スキル需要計算

- 中間ファイルを読み込み
- スキル構成比を適用して需要を計算
- 最終結果を`out/*.csv`に保存

**ステップ2のみ実行した場合の活用例:**

1. ステップ1で生成された中間ファイルをExcelなどで開く
2. 機械分類の結果を人手で修正（例: 規模や種別の手動変更）
3. 修正したCSVを保存
4. ステップ2のみを実行して、修正後の分類結果から需要を計算

### 4. 結果の確認

- **中間ファイル**: `intermediate/`フォルダで分類結果を確認
- **最終結果**: `out/`フォルダでスキル需要計算結果を確認

---
<br>

## 計算ロジック

### 1. プロジェクト規模の推定

投資金額から総人月を計算し、規模を判定します:

```
人月 = (初期投資金額 × 人件費比率) ÷ 平均単価 × 内製比率
```

**デフォルトパラメータ**（calc_assumptions.yaml で変更可能）:
- 人件費比率: 80%
- 平均単価: 2,000千円/人月
- 内製比率: 30%

**規模判定基準**:
- **大規模**: 150人月以上
- **中規模**: 50人月以上150人月未満
- **小規模**: 20人月以上50人月未満
- **極小規模**: 20人月未満

### 2. 技術領域の判定

プロジェクト名に含まれるキーワードで判定します（`config/keywords.json`で定義）:

| 技術領域 | キーワード（デフォルト） |
|---------|----------|
| AI/ML | AI活用、機械学習、人工知能 |
| クラウド | クラウド、AWS、Azure、GCP |
| DX/デジタル | DX推進、デジタル、デジタル化 |
| 従来型 | 上記以外のすべて |

### 3. プロジェクト種別の判定

プロジェクト名に含まれるキーワードで判定します（`config/keywords.json`で定義）:

| プロジェクト種別 | キーワード（デフォルト） | 説明 |
|---------------|----------|------|
| 新規開発 | 開発、構築 | 構想・PoC・プロトタイプ開発 |
| 導入 | 導入 | 要件定義～本番導入 |
| 刷新 | 刷新、リプレース | 既存システムの更改 |
| 移行 | 移行 | システム移行・データ移行 |
| その他 | 上記以外 | その他のプロジェクト |

### 4. スキル需要の計算

プロジェクト規模とプロジェクト種別の組み合わせに応じたスキル構成比を適用します:

```
各ケイパビリティの需要(人月) = 総人月 × スキル構成比
```

**スキル構成比の例** (大規模 × 新規開発):
- ビジネスケイパビリティ: 35%
- デリバリケイパビリティ: 20%
- テクニカルケイパビリティ: 30%
- リーダーシップケイパビリティ: 15%

### 5. 運用需要の計算

```
運用人月 = (運用費 × 人件費比率) ÷ 平均単価
```

**デフォルトパラメータ**（calc_assumptions.yaml で変更可能）:
- 人件費比率: 90%
- 平均単価: 1,000千円/人月

**運用フェーズのスキル配分比率**（固定）:
- ビジネスケイパビリティ: 10%
- デリバリケイパビリティ: 30%
- テクニカルケイパビリティ: 55%
- リーダーシップケイパビリティ: 5%

---
<br>

## 設定ファイル詳細

### calc_assumptions.yaml（YAML設定ファイル）

設定ファイルで以下のパラメータをカスタマイズできます:

#### 1. プロジェクト規模の判定基準

```yaml
project_size_thresholds:
  large:
    min_person_months: 150    # 150人月以上
  medium:
    min_person_months: 50     # 50人月以上
  small:
    min_person_months: 20     # 20人月以上
  extra_small:
    min_person_months: 0      # 20人月未満
```

#### 2. スキル構成比

プロジェクト規模×種別ごとに定義:

```yaml
skill_distribution:
  large_新規開発:
    "ビジネスケイパビリティ": 0.35
    "デリバリケイパビリティ": 0.20
    "テクニカルケイパビリティ": 0.30
    "リーダーシップケイパビリティ": 0.15
  # ...（20パターン定義）
```

#### 3. 投資金額から人月を推定するパラメータ

```yaml
investment_to_person_months:
  labor_cost_ratio: 0.80   # 初期投資のうち人件費が占める比率
  average_unit_cost: 2000  # 平均単価（千円/人月）
  in_house_ratio: 0.3      # 内製比率
```

#### 4. 運用需要の計算パラメータ

```yaml
operation_parameters:
  labor_cost_ratio: 0.90  # 運用費のうち人件費が占める比率
  average_unit_cost: 1000 # 平均単価（千円/人月）
```

### keywords.json（キーワード定義ファイル）

分類に使用するキーワードを定義します。詳細は`config/KEYWORDS_README.md`を参照してください。

---

## データバリデーション機能

プログラム実行時に以下のバリデーションが自動的に実行されます:

### 1. 設定ファイルのバリデーション
- ゼロ除算の原因となる設定値のチェック
- 必須パラメータの存在確認

### 2. 入力データのバリデーション
- **構造チェック**: 必須列の存在、列名の重複
- **データ型チェック**: 数値列、日付列のフォーマット
- **値範囲チェック**: 負の値、異常値の検出
- **論理整合性チェック**: 活動期間の妥当性
- **データ品質チェック**: キーワードマッチング率

バリデーションエラーが検出された場合、処理は中断され、エラー内容が表示されます。

---

## トラブルシューティング

### Q1: 分類精度が低い

**A**: `config/keywords.json`のキーワードを追加・調整してください。

例: プロジェクト名に「PoC」が含まれる場合を新規開発として分類したい
```json
"新規開発": [
  "開発",
  "構築",
  "PoC"  ← 追加
]
```

### Q2: 投資金額から推定される人月が実態と合わない

**A**: `calc_assumptions.yaml`の以下のパラメータを調整してください:
- `labor_cost_ratio`: 人件費比率
- `average_unit_cost`: 平均単価
- `in_house_ratio`: 内製比率

### Q3: バリデーションエラーが発生する

**A**: エラーメッセージを確認し、該当するデータを修正してください:
- 必須列の空欄を埋める
- 数値列に文字が入っていないか確認
- 日付フォーマットを統一（推奨: YYYY/MM/DD）

### Q4: 中間ファイルの分類結果を手動で修正したい

**A**: 
1. ステップ1のみを実行
2. `intermediate/classified_*.csv`をExcelで開く
3. 「プロジェクト規模」「プロジェクト種別」列を手動修正
4. 保存後、ステップ2のみを実行

---

## ライセンス

このプログラムは内部利用を目的としています。

---

## 更新履歴

### v2.0
- キーワード定義をJSONファイルに分離
- データバリデーション機能を追加
- 設定ファイルのバリデーション機能を追加
- 2段階処理の導入（分類→需要計算）

### v1.0
- 初版リリース

---
<br>
<br>

**APPENDIX**

# キーワード定義ファイル説明

## keywords.json

プロジェクト分類に使用するキーワード定義を管理するファイルです。

### プロジェクト種別の定義

| 種別 | 説明 | キーワード |
|------|------|------------|
| 新規開発 | 構想・PoC・プロトタイプ開発（本格開発前の検証フェーズ） | 開発, 構築 |
| 導入 | 要件定義～本番導入（本番向けの新規設計・実装） | 導入 |
| 刷新 | 既存システムの更改・リプレース | 刷新, リプレース |
| 移行 | システム移行・データ移行 | 移行 |
| その他 | 上記に該当しないプロジェクト | (デフォルト) |

### 技術領域の定義

| 領域 | キーワード |
|------|------------|
| AI/ML | AI活用, 機械学習, 人工知能 |
| クラウド | クラウド, AWS, Azure, GCP |
| DX/デジタル | DX推進, デジタル, デジタル化 |
| 従来型 | (デフォルト) |

### キーワードの追加方法

1. `keywords.json`をテキストエディタで開く
2. 該当するカテゴリの配列にキーワードを追加
3. JSON形式を保持する（カンマ、ブラケットに注意）

**例: AI/MLにキーワード追加**
```json
"AI/ML": [
  "AI活用",
  "機械学習",
  "人工知能",
  "ディープラーニング"  ← 追加
]
```

### 注意事項

- キーワードは大文字・小文字を区別します
- 案件名に含まれる文字列で部分一致判定を行います
- 複数のキーワードがマッチする場合、最初にマッチしたものが適用されます
- "default"は特殊キーワードで、他のキーワードにマッチしない場合のデフォルト値です
