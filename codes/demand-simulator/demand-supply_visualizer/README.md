# プロジェクトポートフォリオ分析 - ケイパビリティ可視化ツール

需要データ（案件データ）と供給データ（社員データ）を読み込み、ケイパビリティ別のリソース需給バランスをグラフ化するツールです。

## 必要要件

- Python 3.8以上

## セットアップ

### 0. 仮想環境の作成（推奨）
```bash
# 仮想環境を作成
python3 -m venv venv

# 仮想環境を有効化（macOS/Linux）
source venv/bin/activate

# 仮想環境を有効化（Windows）
venv\Scripts\activate
```

### 1. 依存ライブラリのインストール

```bash
pip install -r requirements.txt
```

必要なライブラリ:
- pandas
- matplotlib
- numpy

## 使い方

### 基本的な使い方

1. `csv/` ディレクトリに以下のファイルを配置：
   - `demand_data.csv`（必須）: 需要データ（案件データ）
   - `supply_data.csv`（オプション）: 供給データ（社員データ）

2. メインプログラムを実行：

```bash
python main.py
```

### 実行例

```
============================================================
プロジェクトポートフォリオ分析 - ケイパビリティ可視化
============================================================
需要データ: csv/demand_data.csv
供給データ: csv/supply_data.csv
出力ディレクトリ: /path/to/png

============================================================
実行中: visualize_capability.py
============================================================
グラフを作成しました: png/capability_demand_charts.png

============================================================
実行中: visualize_by_tech.py
============================================================
積み上げ面グラフを作成しました: png/capability_by_tech_stacked.png
折れ線グラフを作成しました: png/capability_by_tech_lines.png

============================================================
実行中: visualize_supply_demand.py
============================================================
FTE正規化処理
正規化前のケイパビリティ合計: 最小=1.09, 最大=3.56, 平均=2.41
正規化後のケイパビリティ合計: 最小=1.00, 最大=1.00, 平均=1.00
表示期間: 2024年01月 〜 2028年08月
需給バランスグラフを作成しました: png/supply_demand_balance.png

============================================================
実行結果サマリー
============================================================
成功: 3/3 スクリプト

✓ すべてのグラフ生成が完了しました！

出力ファイル:
  - capability_by_tech_lines.png (XXX.X KB)
  - capability_by_tech_stacked.png (XXX.X KB)
  - capability_demand_charts.png (XXX.X KB)
  - supply_demand_balance.png (XXX.X KB)

場所: /path/to/png
```

## 出力されるグラフ

### 1. capability_demand_charts.png
**ケイパビリティ全体の需要推移**

4つのケイパビリティ（Business、Delivery、Technical、Leadership）ごとの月次需要を2つの形式で可視化：
- 積み上げ面グラフ: 全体の需要推移を表示
- 折れ線グラフ: 各ケイパビリティの需要推移を個別に表示

**特徴:**
- 最大値と発生月を表示
- 平均値の統計情報を出力

### 2. capability_by_tech_stacked.png
**技術領域別の需要推移（積み上げ面グラフ）**

4つのケイパビリティを技術領域別（従来型、AI/ML、DX/デジタル、クラウド）に分類して積み上げ面グラフで表示。

**特徴:**
- 技術領域ごとに色分け表示
- ピーク需要と発生月を表示
- 技術領域ごとの需要推移を把握

### 3. capability_by_tech_lines.png
**技術領域別の需要推移（折れ線グラフ）**

4つのケイパビリティを技術領域別に折れ線グラフで表示。

**特徴:**
- 各技術領域の最大値をアノテーション表示
- 技術領域間の比較が容易
- 平均値と最大値の統計情報を出力

### 4. supply_demand_balance.png
**需給バランス（FTE正規化済み）**

需要と供給を比較し、リソースのバランスを可視化。

**特徴:**
- 需要（赤線）と供給（青線）を重ねて表示
- 供給不足（赤の背景）と供給過剰（青の背景）を色分け
- FTE（Full-Time Equivalent）正規化により、1人=1.0人月として計算
- 最大不足・最大余剰とその発生月を表示
- 表示期間は需要データの期間に限定

**FTE正規化について:**
供給データの各社員のケイパビリティ合計を1.0に正規化することで、物理的に妥当な供給量を算出します。
```
例: 社員のケイパビリティ値
  Business: 0.62
  Delivery: 0.78
  Technical: 0.80
  Leadership: 0.61
  合計: 2.81

正規化後:
  Business: 0.22 (0.62 ÷ 2.81)
  Delivery: 0.28 (0.78 ÷ 2.81)
  Technical: 0.28 (0.80 ÷ 2.81)
  Leadership: 0.22 (0.61 ÷ 2.81)
  合計: 1.00 FTE
```

## データファイル仕様

### 需要データ（demand_data.csv）

**必須フィールド:**
- `活動開始月`: プロジェクトの開始月（例: 2024/01）
- `活動終了月`: プロジェクトの終了月（例: 2025/12）
- `活動期間月数`: プロジェクトの期間（月数）
- `ビジネスケイパビリティ`: プロジェクト全体で必要なビジネス人月
- `デリバリケイパビリティ`: プロジェクト全体で必要なデリバリ人月
- `テクニカルケイパビリティ`: プロジェクト全体で必要なテクニカル人月
- `リーダーシップケイパビリティ`: プロジェクト全体で必要なリーダーシップ人月
- `技術領域`: 技術領域の分類（従来型、AI/ML、DX/デジタル、クラウド）

**サンプル:**
```csv
案件ID,案件名,活動開始月,活動終了月,活動期間月数,技術領域,ビジネスケイパビリティ,デリバリケイパビリティ,テクニカルケイパビリティ,リーダーシップケイパビリティ
PRJ0001,AI活用販売管理システム移行,2024/09,2025/10,14,AI/ML,0.27,0.62,0.8,0.09
PRJ0002,DX推進基幹システム移行,2026/01,2026/04,4,DX/デジタル,1.24,2.89,3.71,0.41
```

**集計方法:**
各プロジェクトのケイパビリティ需要を活動期間で均等配分し、月次で集計します。
```
例: PRJ0001のビジネスケイパビリティ
  総需要: 0.27人月
  期間: 14ヶ月
  月平均: 0.27 ÷ 14 = 0.0193人月/月
  → 2024年9月〜2025年10月の各月に0.0193人月を配分
```

### 供給データ（supply_data.csv）

**必須フィールド:**
- `社員ID`: 社員の識別子
- `稼働開始月`: 社員の稼働開始月（例: 2023/08）
- `稼働終了月`: 社員の稼働終了月（空欄可、退職予定など）
- `ビジネスケイパビリティ`: ビジネススキルの評価値（0.0〜1.0）
- `デリバリケイパビリティ`: デリバリスキルの評価値（0.0〜1.0）
- `テクニカルケイパビリティ`: テクニカルスキルの評価値（0.0〜1.0）
- `リーダーシップケイパビリティ`: リーダーシップの評価値（0.0〜1.0）

**サンプル:**
```csv
社員ID,稼働開始月,稼働終了月,ビジネスケイパビリティ,デリバリケイパビリティ,テクニカルケイパビリティ,リーダーシップケイパビリティ
EMP00001,2023/08,,0.62,0.78,0.8,0.61
EMP00002,2021/02,,0.35,0.45,0.34,0.44
EMP00003,2023/09,2027/02,0.44,0.55,0.76,0.42
```

**注意事項:**
- ケイパビリティ値は、フルタイム稼働時のスキルレベルを表します
- 値の合計が1.0を超える場合は自動的にFTE正規化されます
- 稼働終了月が空欄の場合は、2030年12月まで稼働と仮定されます

**集計方法:**
各社員のケイパビリティ値をFTE正規化し、稼働期間中の各月に加算します。
```
例: EMP00001
  元の値: Business=0.62, Delivery=0.78, Technical=0.80, Leadership=0.61
  合計: 2.81
  
  FTE正規化後:
    Business: 0.62 ÷ 2.81 = 0.22人月/月
    Delivery: 0.78 ÷ 2.81 = 0.28人月/月
    Technical: 0.80 ÷ 2.81 = 0.28人月/月
    Leadership: 0.61 ÷ 2.81 = 0.22人月/月
    合計: 1.00人月/月（1.0 FTE）
  
  → 2023年8月〜2030年12月の各月に上記の値を配分
```

## ファイル構成

```
.
├── main.py                          # メインエントリポイント
├── visualize_capability.py          # ケイパビリティ全体の可視化
├── visualize_by_tech.py             # 技術領域別の可視化
├── visualize_supply_demand.py       # 需給バランスの可視化
├── csv/                             # 入力データフォルダ
│   ├── demand_data.csv             # 需要データ（必須）
│   └── supply_data.csv             # 供給データ（オプション）
├── png/                             # 出力フォルダ（自動生成）
│   ├── capability_demand_charts.png
│   ├── capability_by_tech_stacked.png
│   ├── capability_by_tech_lines.png
│   └── supply_demand_balance.png
├── requirements.txt                 # 必要なライブラリ
└── README.md                        # このファイル
```

## 個別スクリプトの実行

各可視化スクリプトを個別に実行することも可能です。

### ケイパビリティ全体の可視化
```bash
python visualize_capability.py csv/demand_data.csv
```

### 技術領域別の可視化
```bash
python visualize_by_tech.py csv/demand_data.csv
```

### 需給バランスの可視化
```bash
python visualize_supply_demand.py csv/demand_data.csv csv/supply_data.csv
```

## 統計情報の出力

各スクリプトは実行時にコンソールに統計情報を出力します。

### 例: visualize_capability.py の出力
```
=== 各ケイパビリティの統計情報 ===

最大値:
  Business: 1.72 人月 (発生月: 2025年06月)
  Delivery: 1.77 人月 (発生月: 2026年01月)
  Technical: 4.18 人月 (発生月: 2025年06月)
  Leadership: 0.40 人月 (発生月: 2025年06月)

平均値:
  Business: 0.91 人月
  Delivery: 1.03 人月
  Technical: 2.54 人月
  Leadership: 0.25 人月

全体リソース需要:
  最大: 7.64 人月 (発生月: 2025年06月)
  平均: 4.73 人月
```

### 例: visualize_supply_demand.py の出力
```
=== 需給バランス統計情報（FTE正規化版） ===

【Business Capability】
  平均需要: 0.91 人月
  平均供給: 8.56 人月 (FTE正規化済み)
  平均バランス: 7.65 人月
  最大不足: 0.00 人月
  最大余剰: 19.52 人月 (2025年06月)
  不足月数: 0 ヶ月
  余剰月数: 56 ヶ月
  均衡月数: 0 ヶ月

=== 全体サマリー ===
全ケイパビリティ合計:
  平均総需要: 4.73 人月
  平均総供給: 38.00 人月 (FTE正規化済み)
  平均総バランス: 33.27 人月

=== 供給側の人数（FTE換算） ===
2025年6月の稼働社員数: 38人 (各1.0 FTE)
  総供給能力: 38.00 FTE
```

## トラブルシューティング

### エラー: CSVファイルが見つかりません
```
エラー: csv/ ディレクトリが見つかりません。
```

**解決方法:**
1. `csv/` ディレクトリを作成してください
2. `demand_data.csv` を配置してください

### エラー: 日付フォーマットが不正です
```
UserWarning: Could not infer format...
```

**解決方法:**
日付フィールドが `YYYY/MM` または `YYYY/MM/DD` 形式になっているか確認してください。

### グラフが表示されない（日本語フォントの問題）
グラフのタイトルや軸ラベルが文字化けする場合は、システムに日本語フォントがインストールされているか確認してください。

**macOS:** Hiragino Sans（デフォルトでインストール済み）
**Windows:** Yu Gothic、Meiryo（デフォルトでインストール済み）
**Linux:** 
```bash
# Ubuntu/Debian
sudo apt-get install fonts-noto-cjk

# CentOS/RHEL
sudo yum install google-noto-sans-cjk-fonts
```

## カスタマイズ

### グラフの色やスタイルの変更

各可視化スクリプトの以下の部分を編集してください：

**visualize_by_tech.py の色設定:**
```python
tech_colors = {
    '従来型': '#4A90E2',      # 青
    'AI/ML': '#E94B3C',       # 赤
    'DX/デジタル': '#50C878',  # 緑
    'クラウド': '#F5A623'      # オレンジ
}
```

**visualize_supply_demand.py の色設定:**
```python
colors_demand = '#E94B3C'  # 赤（需要）
colors_supply = '#4A90E2'  # 青（供給）
colors_balance = '#50C878'  # 緑（バランス）
```

### グラフのサイズや解像度の変更

```python
# グラフサイズ（インチ）
fig, axes = plt.subplots(2, 2, figsize=(18, 14))

# 保存時の解像度（DPI）
plt.savefig('png/output.png', dpi=300, bbox_inches='tight')
```

### 月次集計の間隔変更

X軸の日付表示間隔を変更：
```python
# 4ヶ月間隔 → 3ヶ月間隔に変更
ax.xaxis.set_major_locator(mdates.MonthLocator(interval=3))
```
