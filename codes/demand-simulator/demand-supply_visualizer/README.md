# プロジェクトポートフォリオ分析 - ケイパビリティ可視化ツール

需要データ（案件データ）と供給データ（社員データ）を読み込み、ケイパビリティ別のリソース需給バランスをグラフ化するツールです。

## 必要要件

- Python 3.8以上

## セットアップ

### 0. 仮想環境の作成（推奨）
```bash
# 仮想環境を作成
python3 -m venv venv

# 仮想環境を有効化（macOS/Linux）
source venv/bin/activate

# 仮想環境を有効化（Windows）
venv\Scripts\activate
```

### 1. 依存ライブラリのインストール

```bash
pip install -r requirements.txt
```

必要なライブラリ:
- pandas
- matplotlib
- numpy

## 使い方

### 基本的な使い方

1. `csv/` ディレクトリに以下のファイルを配置：
   - `demand_data.csv`（必須）: 需要データ（案件データ）
   - `supply_data.csv`（オプション）: 供給データ（社員データ）

2. メインプログラムを実行：

```bash
python main.py
```

### 実行例

```
============================================================
プロジェクトポートフォリオ分析 - ケイパビリティ可視化
============================================================
需要データ: csv/demand_data.csv
供給データ: csv/supply_data.csv
出力ディレクトリ: /path/to/png

============================================================
実行中: modules/visualize_capability.py
============================================================
グラフを作成しました: png/capability_demand_charts.png

============================================================
実行中: modules/visualize_by_tech.py
============================================================
技術領域別グラフを作成しました: png/capability_by_tech_charts.png

============================================================
実行中: modules/visualize_supply.py
============================================================
供給グラフを作成しました: png/capability_supply_charts.png

============================================================
実行中: modules/visualize_supply_demand.py
============================================================
2ステップ正規化処理（正規化 → FTE乗算）
稼働期間FTEの範囲: 最小=1.00, 最大=1.00, 平均=1.00
表示期間: 2024年01月 〜 2028年08月
需給バランスグラフ（4分割）を作成しました: png/supply_demand_balance.png
需給バランスグラフ（合計・2段構成）を作成しました: png/supply_demand_balance_total.png

============================================================
実行結果サマリー
============================================================
成功: 4/4 スクリプト

✓ すべてのグラフ生成が完了しました！

出力ファイル:
  - capability_demand_charts.png (XXX.X KB)
  - capability_supply_charts.png (XXX.X KB)
  - capability_by_tech_charts.png (XXX.X KB)
  - supply_demand_balance.png (XXX.X KB)
  - supply_demand_balance_total.png (XXX.X KB)

場所: /path/to/png
```

## 出力されるグラフ

### 1. capability_demand_charts.png
**ケイパビリティ需要の推移**

4つのケイパビリティ（Business、Delivery、Technical、Leadership）ごとの月次需要を2つの形式で可視化：
- 上段：積み上げ面グラフ - 全体の需要推移を表示
- 下段：折れ線グラフ - 各ケイパビリティの需要推移を個別に表示

**特徴:**
- 最大値と発生月を表示
- 平均値の統計情報を出力

### 2. capability_supply_charts.png
**ケイパビリティ供給の推移（FTE考慮版）**

4つのケイパビリティごとの月次供給を2つの形式で可視化：
- 上段：積み上げ面グラフ - 全体の供給推移を表示
- 下段：折れ線グラフ - 各ケイパビリティの供給推移を個別に表示

**特徴:**
- 2ステップFTE正規化：ケイパビリティ比率を正規化後、稼働期間FTEを乗算
- 最大値と発生月を表示
- 平均値の統計情報を出力

### 3. capability_by_tech_charts.png
**技術領域別の需要推移（2段構成）**

4つの技術領域（従来型、AI/ML、DX/デジタル、クラウド）ごとの全ケイパビリティ合計を可視化：
- 上段：積み上げ面グラフ - 技術領域別の需要推移
- 下段：折れ線グラフ - 技術領域ごとのトレンド比較

**特徴:**
- 技術領域ごとに色分け表示
- 最大値をアノテーション表示
- 技術領域間の比較が容易

### 4. supply_demand_balance.png
**需給バランス（4分割・FTE正規化済み）**

4つのケイパビリティごとに需要と供給を比較し、リソースのバランスを可視化。

**特徴:**
- 需要（赤線）と供給（青線）を重ねて表示
- 供給不足（赤の背景）と供給過剰（青の背景）を色分け
- 2ステップFTE正規化：ケイパビリティ比率を正規化後、稼働期間FTEを乗算
- 最大不足・最大余剰とその発生月を表示
- 表示期間は需要データの期間に限定

### 5. supply_demand_balance_total.png
**需給バランス（全体合計・2段構成）**

全ケイパビリティを合計した需給バランスを可視化：
- 上段：月次の需給バランス - 総需要と総供給の推移
- 下段：累積バランス - 時系列での累計推移

**特徴:**
- 上段：月次の供給余剰/不足を面グラフで表示
- 下段：累積需要と累積供給の推移を表示（開始月からの積み上げ）
- 最終累積値と最大累積不足/余剰を表示
- プロジェクト期間全体での需給バランスを把握

**FTE正規化について:**
供給データの各社員のケイパビリティ合計を1.0に正規化することで、物理的に妥当な供給量を算出します。
```
例: 社員のケイパビリティ値
  Business: 0.62
  Delivery: 0.78
  Technical: 0.80
  Leadership: 0.61
  合計: 2.81

正規化後:
  Business: 0.22 (0.62 ÷ 2.81)
  Delivery: 0.28 (0.78 ÷ 2.81)
  Technical: 0.28 (0.80 ÷ 2.81)
  Leadership: 0.22 (0.61 ÷ 2.81)
  合計: 1.00 FTE
```

## データファイル仕様

### 需要データ（demand_data.csv）

**必須フィールド:**
- `活動開始月`: プロジェクトの開始月（例: 2024/01）
- `活動終了月`: プロジェクトの終了月（例: 2025/12）
- `活動期間月数`: プロジェクトの期間（月数）
- `ビジネスケイパビリティ`: プロジェクト全体で必要なビジネス人月
- `デリバリケイパビリティ`: プロジェクト全体で必要なデリバリ人月
- `テクニカルケイパビリティ`: プロジェクト全体で必要なテクニカル人月
- `リーダーシップケイパビリティ`: プロジェクト全体で必要なリーダーシップ人月
- `技術領域`: 技術領域の分類（従来型、AI/ML、DX/デジタル、クラウド）

**サンプル:**
```csv
案件ID,案件名,活動開始月,活動終了月,活動期間月数,技術領域,ビジネスケイパビリティ,デリバリケイパビリティ,テクニカルケイパビリティ,リーダーシップケイパビリティ
PRJ0001,AI活用販売管理システム移行,2024/09,2025/10,14,AI/ML,0.27,0.62,0.8,0.09
PRJ0002,DX推進基幹システム移行,2026/01,2026/04,4,DX/デジタル,1.24,2.89,3.71,0.41
```

**集計方法:**
各プロジェクトのケイパビリティ需要を活動期間で均等配分し、月次で集計します。
```
例: PRJ0001のビジネスケイパビリティ
  総需要: 0.27人月
  期間: 14ヶ月
  月平均: 0.27 ÷ 14 = 0.0193人月/月
  → 2024年9月〜2025年10月の各月に0.0193人月を配分
```

### 供給データ（supply_data.csv）

**必須フィールド:**
- `社員ID`: 社員の識別子
- `稼働開始月`: 社員の稼働開始月（例: 2023/08）
- `稼働終了月`: 社員の稼働終了月（空欄可、退職予定など）
- `稼働期間FTE`: 稼働率（0.0〜1.0、例: 0.5は50%稼働）
- `ビジネスケイパビリティ`: ビジネススキルの評価値（0.0〜1.0）
- `デリバリケイパビリティ`: デリバリスキルの評価値（0.0〜1.0）
- `テクニカルケイパビリティ`: テクニカルスキルの評価値（0.0〜1.0）
- `リーダーシップケイパビリティ`: リーダーシップの評価値（0.0〜1.0）

**サンプル:**
```csv
社員ID,稼働開始月,稼働終了月,稼働期間FTE,ビジネスケイパビリティ,デリバリケイパビリティ,テクニカルケイパビリティ,リーダーシップケイパビリティ
EMP00001,2023/08,,1.0,0.62,0.78,0.8,0.61
EMP00002,2021/02,,0.5,0.35,0.45,0.34,0.44
EMP00003,2023/09,2027/02,0.8,0.44,0.55,0.76,0.42
```

**注意事項:**
- `稼働期間FTE`: 1.0=フルタイム、0.5=50%稼働（例: 週2.5日勤務）
- `稼働期間FTE`がない場合は1.0（フルタイム）として扱われます
- ケイパビリティ値は、フルタイム稼働時のスキルレベルを表します
- 値の合計が1.0を超える場合は自動的に比率が正規化されます
- 稼働終了月が空欄の場合は、2030年12月まで稼働と仮定されます

**集計方法（2ステップFTE正規化）:**
各社員のケイパビリティ値を正規化し、稼働期間FTEを乗算して実効供給能力を算出します。
```
例: EMP00002
  元の値: Business=0.35, Delivery=0.45, Technical=0.34, Leadership=0.44
  合計: 1.58
  稼働期間FTE: 0.5 (50%稼働)
  
  ステップ1: ケイパビリティ比率を正規化（合計=1.0）
    Business: 0.35 ÷ 1.58 = 0.22
    Delivery: 0.45 ÷ 1.58 = 0.28
    Technical: 0.34 ÷ 1.58 = 0.22
    Leadership: 0.44 ÷ 1.58 = 0.28
    合計: 1.00
  
  ステップ2: 稼働期間FTEを乗算（実効供給能力）
    Business: 0.22 × 0.5 = 0.11人月/月
    Delivery: 0.28 × 0.5 = 0.14人月/月
    Technical: 0.22 × 0.5 = 0.11人月/月
    Leadership: 0.28 × 0.5 = 0.14人月/月
    合計: 0.50人月/月（0.5 FTE = 50%稼働）
  
  → 2021年2月〜2030年12月の各月に上記の値を配分
```

## ファイル構成

```
.
├── main.py                          # メインエントリポイント
├── modules/                         # 可視化スクリプト
│   ├── visualize_capability.py     # ケイパビリティ需要の可視化
│   ├── visualize_supply.py         # ケイパビリティ供給の可視化
│   ├── visualize_by_tech.py        # 技術領域別の可視化
│   └── visualize_supply_demand.py  # 需給バランスの可視化
├── csv/                             # 入力データフォルダ
│   ├── demand_data.csv             # 需要データ（必須）
│   └── supply_data.csv             # 供給データ（オプション）
├── png/                             # 出力フォルダ（自動生成）
│   ├── capability_demand_charts.png
│   ├── capability_supply_charts.png
│   ├── capability_by_tech_charts.png
│   ├── supply_demand_balance.png
│   └── supply_demand_balance_total.png
├── requirements.txt                 # 必要なライブラリ
└── README.md                        # このファイル
```

