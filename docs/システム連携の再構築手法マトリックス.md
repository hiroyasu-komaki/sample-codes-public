# システム連携における再構築手法の分類と特徴

## 1. 連携再構築手法の全体像

### 分類の考え方
ドキュメント（図1.12）の「現行システムのどのレイヤの設計情報を維持するか」という考え方を、システム連携に応用すると以下のような分類が可能です。

```
【単独システムの再構築】
レイヤ: 要件定義 → 設計 → プログラム → ソース
判断軸: 各レイヤの変更有無

【システム連携の再構築】
レイヤ: 業務連携要件 → I/F仕様 → 連携方式 → データ構造 → 実装
判断軸: 各レイヤの変更有無と連携先への影響範囲
```

---

## 2. 連携再構築手法の詳細分類

### 手法1: 連携維持（Interface Preserve）

| 項目 | 内容 |
|------|------|
| **定義** | 連携先システムへの影響を完全にゼロにする。外部から見たインターフェースは一切変更しない |
| **変更範囲** | • 自システム内部の実装のみ変更<br>• 連携I/F仕様: 現行踏襲<br>• 連携方式: 現行踏襲<br>• データ構造: 現行踏襲 |
| **適用例** | • ファイル連携でファイル形式・項目・配置場所を完全維持<br>• API連携でエンドポイント・リクエスト/レスポンス形式を完全維持<br>• DB参照で公開テーブル定義を完全維持 |
| **実現方法** | • アダプター層/ラッパー層での変換<br>• 内部ロジック変更のみ<br>• 外部公開I/Fは既存のまま維持 |
| **難易度** | **小** |
| **連携先への影響** | なし（連携先の変更不要） |
| **検証範囲** | • 自システム内のみ<br>• 連携I/Fの互換性確認（現新比較） |

**メリット**:
- 連携先システムの変更が不要
- 連携先との調整が不要
- プロジェクトのスコープを最小化
- リスクが最も低い
- 並行稼働期間を短縮可能

**デメリット**:
- 技術的負債を引き継ぐ可能性
- 非効率な連携方式を継続
- レガシーな連携方式への依存
- 将来的な改善余地の制限

**主なリスク**:
- 現行I/F仕様の完全把握漏れ
- 暗黙的な仕様の見落とし
- 非機能要件（性能、タイミング）の変化

---

### 手法2: 連携互換移行（Interface Compatible Migration）

| 項目 | 内容 |
|------|------|
| **定義** | 連携方式の技術は変更するが、論理的なI/F仕様（データ項目、業務的意味）は維持 |
| **変更範囲** | • 連携I/F仕様（論理）: 現行踏襲<br>• 連携方式（物理）: 変更あり<br>• 連携タイミング: 変更可能<br>• データ構造（論理）: 現行踏襲 |
| **適用例** | • ファイル連携 → REST API化（データ項目は同じ）<br>• バッチ連携 → リアルタイム連携化<br>• DB直接参照 → API経由のアクセスに変更<br>• FTP → SFTP/クラウドストレージ |
| **実現方法** | • 連携先にアダプター/変換層を提供<br>• 移行期間中の両方式併存<br>• 段階的な切り替え |
| **難易度** | **中** |
| **連携先への影響** | あり（連携先の実装変更が必要だが、業務ロジックは不要） |
| **検証範囲** | • 新連携方式での動作確認<br>• データ項目の完全性確認<br>• タイミング変更による業務影響確認 |

**メリット**:
- 技術的な刷新が可能
- 効率的な連携方式への移行
- セキュリティ向上の機会
- クラウド対応等の近代化
- 業務ロジックへの影響を最小化

**デメリット**:
- 連携先システムの改修が必要
- 両方式の並行稼働期間が必要
- 移行調整のコストと期間
- 連携先との合意形成の難しさ

**主なリスク**:
- 連携方式変更による非機能要件への影響（性能、タイミング）
- 移行タイミングの調整失敗
- 両方式併存期間のデータ整合性
- 連携先の対応遅延によるプロジェクト遅延

---

### 手法3: 連携プロトコル変更（Protocol Change）

| 項目 | 内容 |
|------|------|
| **定義** | 連携プロトコルやデータフォーマットを変更するが、業務的なデータ項目は維持 |
| **変更範囲** | • 連携I/F仕様: 変更あり（プロトコルレベル）<br>• 連携方式: 変更あり<br>• 連携タイミング: 変更あり<br>• データ構造（論理）: 現行踏襲 |
| **適用例** | • SOAP → REST/GraphQL<br>• XML → JSON<br>• 固定長ファイル → CSV/JSON<br>• 専用プロトコル → 標準プロトコル |
| **実現方法** | • プロトコル変換層の実装<br>• データフォーマット変換<br>• 新旧両方式の一時的共存 |
| **難易度** | **中～大** |
| **連携先への影響** | あり（連携先の実装変更が必要） |
| **検証範囲** | • プロトコル変換の正確性<br>• データ項目の完全性<br>• エラーハンドリング<br>• 性能要件の充足 |

**メリット**:
- モダンなプロトコルへの移行
- 標準技術の採用による保守性向上
- 開発効率の向上
- エコシステムとの親和性

**デメリット**:
- 連携先の大規模改修が必要な場合あり
- プロトコル変換のオーバーヘッド
- 移行期間の長期化
- テスト範囲の拡大

**主なリスク**:
- プロトコル変換ロジックのバグ
- データ型変換での精度損失
- エラーハンドリングの差異
- 性能劣化
- セキュリティ設定の見落とし

---

### 手法4: 連携全面刷新（Interface Redesign）

| 項目 | 内容 |
|------|------|
| **定義** | 業務連携要件から見直し、I/F仕様、連携方式、データ構造を全面的に再設計 |
| **変更範囲** | • 業務連携要件: 見直しあり<br>• 連携I/F仕様: 全面変更<br>• 連携方式: 変更あり<br>• データ構造: 変更あり |
| **適用例** | • レガシー連携の完全刷新<br>• マイクロサービス化に伴う連携再設計<br>• データ項目の正規化・最適化<br>• イベント駆動アーキテクチャへの移行 |
| **実現方法** | • 業務要件からの再定義<br>• API設計のベストプラクティス適用<br>• データモデルの最適化 |
| **難易度** | **大** |
| **連携先への影響** | 大（連携先も大規模改修が必要） |
| **検証範囲** | • 業務要件の充足性<br>• 新I/F仕様の妥当性<br>• 統合テスト<br>• 移行シナリオの検証 |

**メリット**:
- 最適なアーキテクチャの実現
- 技術的負債の解消
- 将来の拡張性確保
- ビジネス要件への最適化
- データ品質の向上

**デメリット**:
- 最も高コスト
- 最も長期間
- 最も高リスク
- 関係者調整の複雑化
- プロジェクトスコープの拡大

**主なリスク**:
- 要件定義の誤り・漏れ
- 関係システム全体への波及
- 移行計画の複雑化
- ビッグバン移行のリスク
- 連携先との調整難航

---

## 3. 連携方式別の再構築パターン

### 3.1 API連携の場合

| 再構築手法 | 現行 | 新システム | 連携先への影響 | 実装例 |
|-----------|------|----------|--------------|--------|
| 連携維持 | REST API v1 | REST API v1（内部実装のみ変更） | なし | エンドポイント、リクエスト/レスポンス形式維持 |
| 連携互換移行 | REST API v1 | REST API v2（後方互換） | 小（任意でv2利用可） | v1も継続提供、v2で機能拡張 |
| プロトコル変更 | SOAP/XML | REST/JSON | 中～大 | データ項目は同じ、形式のみ変更 |
| 連携全面刷新 | SOAP/XML | GraphQL | 大 | データモデルから再設計 |

### 3.2 ファイル連携の場合

| 再構築手法 | 現行 | 新システム | 連携先への影響 | 実装例 |
|-----------|------|----------|--------------|--------|
| 連携維持 | FTPで固定長ファイル | FTPで固定長ファイル | なし | ファイル形式、配置場所完全維持 |
| 連携互換移行 | FTPで固定長 | SFTPで固定長 | 小 | セキュリティ向上、形式維持 |
| プロトコル変更 | FTPで固定長 | SFTPでCSV/JSON | 中～大 | ファイル形式変更、項目は維持 |
| 連携全面刷新 | バッチファイル連携 | リアルタイムAPI連携 | 大 | 連携方式とタイミングを根本変更 |

### 3.3 DB直接参照の場合

| 再構築手法 | 現行 | 新システム | 連携先への影響 | 実装例 |
|-----------|------|----------|--------------|--------|
| 連携維持 | 公開テーブル直接参照 | 公開テーブル（ビュー）提供 | なし | テーブル構造完全維持 |
| 連携互換移行 | テーブル直接参照 | 読取専用ビュー提供 | 小 | アクセス方法変更、項目維持 |
| プロトコル変更 | DB直接参照 | REST API提供 | 中～大 | 参照方式を変更 |
| 連携全面刷新 | DB直接参照 | イベント駆動型連携 | 大 | リアルタイム通知方式に変更 |

---

## 4. 難易度とリスクのマトリックス

### 4.1 実現難易度（連携先数との関係）

| 再構築手法 | 連携先1-2システム | 連携先3-5システム | 連携先6-10システム | 連携先11システム以上 |
|-----------|----------------|----------------|-----------------|-------------------|
| 連携維持 | 小 | 小～中 | 中 | 中～大 |
| 連携互換移行 | 中 | 中～大 | 大 | 大 |
| プロトコル変更 | 中～大 | 大 | 大 | 非常に大 |
| 連携全面刷新 | 大 | 大 | 非常に大 | 極めて困難 |

### 4.2 主要リスク一覧

| リスク分類 | 連携維持 | 連携互換移行 | プロトコル変更 | 連携全面刷新 |
|-----------|---------|------------|-------------|------------|
| **I/F仕様の理解不足** | ◎ | ◎ | ◎ | ○ |
| **暗黙仕様の見落とし** | ◎ | ○ | ○ | △ |
| **非機能要件の変化** | ○ | ◎ | ◎ | ◎ |
| **連携先との調整難航** | △ | ○ | ◎ | ◎ |
| **移行タイミング調整** | ○ | ◎ | ◎ | ◎ |
| **データ整合性** | ○ | ◎ | ◎ | ◎ |
| **テスト範囲の拡大** | ○ | ◎ | ◎ | ◎ |
| **並行稼働の複雑化** | △ | ○ | ◎ | ◎ |

凡例: ◎=高リスク、○=中リスク、△=低リスク

---

## 5. 手法選択の意思決定フレームワーク

### 5.1 選択フローチャート

```
START
  ↓
[連携先システムの改修が可能か？]
  ↓ NO → 【連携維持】を選択
  ↓ YES
  ↓
[業務要件の変更があるか？]
  ↓ YES → 【連携全面刷新】を検討
  ↓ NO
  ↓
[連携方式の技術刷新が必要か？]
  ↓ YES → [データ構造の変更が必要か？]
  |          ↓ YES → 【プロトコル変更】
  |          ↓ NO  → 【連携互換移行】
  ↓ NO
  ↓
【連携維持】を選択
```

### 5.2 判断基準マトリックス

| 判断基準 | 連携維持 | 連携互換移行 | プロトコル変更 | 連携全面刷新 |
|---------|---------|------------|-------------|------------|
| **連携先の改修可否** | 不可 | 可（小規模） | 可（中規模） | 可（大規模） |
| **プロジェクト予算** | 小 | 中 | 中～大 | 大 |
| **プロジェクト期間** | 短 | 中 | 中～長 | 長 |
| **技術的負債解消** | なし | 小 | 中 | 大 |
| **将来の拡張性** | 低 | 中 | 中～高 | 高 |
| **リスク許容度** | 低リスク指向 | 中リスク許容 | 中～高リスク許容 | 高リスク許容 |

---

## 6. 連携方式ごとの品質管理とリスク対策

### 6.1 連携維持の品質管理

**検証項目**:
- [ ] 現行I/F仕様の完全ドキュメント化
- [ ] 現新比較テスト（全パターン網羅）
- [ ] 暗黙仕様の洗い出し（有識者ヒアリング）
- [ ] 非機能要件の検証（性能、タイミング）
- [ ] エラーハンドリングの互換性確認

**主なリスク対策**:
1. **I/F仕様の完全把握**
   - 現行システムのトレース調査
   - 実際の連携データのサンプリング分析
   - 連携先への仕様確認
   
2. **暗黙仕様への対応**
   - エッジケースの洗い出し
   - 例外処理パターンの網羅
   - 有識者インタビュー

3. **互換性検証**
   - 本番同等環境での検証
   - 長期間の監視テスト
   - カナリアリリース

### 6.2 連携互換移行の品質管理

**検証項目**:
- [ ] 新旧両方式での同時稼働検証
- [ ] データ項目の完全性検証
- [ ] タイミング変更の影響分析
- [ ] 移行手順の検証
- [ ] ロールバック手順の検証

**主なリスク対策**:
1. **並行稼働期間の管理**
   - 両方式の同時提供期間設定
   - 段階的な切替計画
   - 連携先ごとの移行スケジュール管理

2. **データ整合性の確保**
   - 新旧データの突合検証
   - リアルタイム監視
   - 差分検知の仕組み

3. **連携先との調整**
   - 移行計画の合意形成
   - テスト環境の提供
   - 移行判断基準の明確化

### 6.3 プロトコル変更の品質管理

**検証項目**:
- [ ] プロトコル変換ロジックの検証
- [ ] データ型変換の精度検証
- [ ] エラーハンドリングの互換性
- [ ] 性能要件の充足確認
- [ ] セキュリティ要件の検証

**主なリスク対策**:
1. **変換ロジックの品質確保**
   - 全データパターンのテスト
   - 境界値テスト
   - 異常系テスト

2. **性能劣化の防止**
   - 性能ベンチマーク
   - 負荷テスト
   - チューニング計画

3. **段階的移行**
   - パイロット運用
   - 段階的ロールアウト
   - 問題発生時の切り戻し準備

### 6.4 連携全面刷新の品質管理

**検証項目**:
- [ ] 業務要件の充足性検証
- [ ] 新I/F仕様の妥当性評価
- [ ] システム間統合テスト
- [ ] 移行シナリオの検証
- [ ] 本番リハーサル

**主なリスク対策**:
1. **要件定義の徹底**
   - ステークホルダー全員の参加
   - ユースケース網羅
   - プロトタイピング

2. **段階的リリース**
   - MVP（最小限の機能）からスタート
   - 機能の段階的追加
   - フィードバックループ

3. **複雑な移行管理**
   - 詳細な移行計画
   - リハーサルの実施
   - 緊急時対応計画

---

## 7. 実践的な推奨アプローチ

### 7.1 ハイブリッドアプローチ

実際のプロジェクトでは、連携先ごとに異なる手法を適用するハイブリッドアプローチが推奨されます。

**例: 基幹システム再構築における連携戦略**

| 連携先システム | 連携方式（現行） | 選択手法 | 理由 |
|-------------|--------------|---------|------|
| 会計システム | ファイル連携（日次バッチ） | 連携維持 | 会計システムは他社製品で改修不可 |
| CRMシステム | DB直接参照 | 連携互換移行 | API化したいが、データ項目は維持 |
| ECサイト | SOAP/XML | プロトコル変更 | REST/JSONに変更、項目は維持 |
| 新規サービス | なし | 連携全面刷新 | 新規なので最適設計が可能 |

### 7.2 段階的アプローチ（ストラングラーパターン）

一度に全てを刷新するのではなく、段階的に移行する戦略:

**フェーズ1（短期）**: 連携維持
- 最小限の変更でシステム稼働
- リスク最小化

**フェーズ2（中期）**: 連携互換移行
- 優先度の高い連携から技術刷新
- 段階的な改善

**フェーズ3（長期）**: 連携全面刷新
- 完全な最適化を実現
- 技術的負債の解消

---

## 8. チェックリスト

### 8.1 連携方式選択時のチェックリスト

**現状分析**:
- [ ] 連携先システムの数を把握
- [ ] 各連携のI/F仕様を文書化
- [ ] 連携方式（API/ファイル/DB）を整理
- [ ] 連携頻度（リアルタイム/バッチ）を確認
- [ ] 入力/出力の方向を明確化
- [ ] データ量とトランザクション数を測定
- [ ] 現行の問題点を洗い出し

**制約条件の確認**:
- [ ] 連携先システムの改修可否を確認
- [ ] 連携先の担当者・ベンダーを特定
- [ ] プロジェクト予算と期間を確認
- [ ] 技術的制約を把握
- [ ] 組織的制約を把握

**リスク評価**:
- [ ] 各手法のリスクを評価
- [ ] リスク対策を計画
- [ ] 連携先との調整工数を見積もり
- [ ] テスト範囲を定義
- [ ] 移行計画を策定

### 8.2 実装時のチェックリスト

**設計フェーズ**:
- [ ] I/F仕様書の作成
- [ ] データフロー図の作成
- [ ] エラーハンドリング設計
- [ ] リトライ・タイムアウト設計
- [ ] ログ・監視設計

**実装フェーズ**:
- [ ] アダプター/変換層の実装
- [ ] エラーハンドリング実装
- [ ] ログ出力実装
- [ ] 単体テスト実施

**テストフェーズ**:
- [ ] 単体テスト
- [ ] 連携テスト（システム間）
- [ ] 性能テスト
- [ ] 障害テスト
- [ ] 移行リハーサル

**移行フェーズ**:
- [ ] 移行手順書の作成
- [ ] ロールバック手順書の作成
- [ ] 連携先との日程調整
- [ ] 本番移行の実施
- [ ] 移行後の監視

---

## 9. まとめ

### 重要なポイント

1. **連携は単独システムより複雑**: 連携先の数だけリスクと調整コストが増加
2. **One Size Fits Allではない**: 連携先ごとに最適な手法を選択
3. **段階的アプローチが現実的**: 一度に全てを変えようとしない
4. **早期の合意形成が重要**: 連携先との調整は最大のボトルネック
5. **互換性維持の価値**: 短期的には制約でも、リスク低減の効果は大きい

### 成功のための原則

1. **現状の完全把握**: I/F仕様の文書化と暗黙仕様の可視化
2. **リスクベースの判断**: リスクと効果のバランスで手法選択
3. **関係者との協働**: 連携先を巻き込んだ計画策定
4. **段階的な実行**: 一度に全てを変えずに段階的に改善
5. **継続的な改善**: 完璧を求めず、継続的に改善する姿勢

---

**補足**: 
この分類は、ドキュメント「システム再構築を成功に導くユーザガイド」の考え方を、システム連携の観点に拡張したものです。実際のプロジェクトでは、これらの手法を組み合わせたハイブリッドアプローチが有効です。
