# データ分析の詳細

## 目次

1. [概要](#概要)
2. [分析の流れ](#分析の流れ)
3. [基本分析](#基本分析)
4. [総合満足度の算出](#総合満足度の算出)
5. [相関分析](#相関分析)
6. [属性別分析](#属性別分析)
7. [IPA分析](#ipa分析)
8. [出力データの構造](#出力データの構造)

---

## 概要

データ分析では、前処理済みデータ（90行×76列）を用いて、IT部門のサービス満足度を多角的に分析します。

**分析の目的:**
- サービス品質の現状把握
- 改善優先順位の特定
- 意思決定のための定量的根拠の提供

**分析手法:**
- 基本分析（記述統計、信頼区間）
- 総合満足度算出（3手法）
- 相関分析（ピアソン相関）
- 属性別分析（ANOVA、多重比較）
- IPA分析（重要度・満足度マトリックス）

---

## 分析の流れ

```
前処理済みデータ（90行×76列）
    ↓
① 基本分析
   - 記述統計
   - 満足度分布
   - 信頼区間
    ↓
② 総合満足度の算出
   - 直接測定法
   - 単純平均法
   - 重要度加重平均法
    ↓
③ 相関分析
   - 総合満足度との相関
   - 重要度との相関
   - 相関行列
    ↓
④ 属性別分析
   - 部署別満足度
   - 職位別満足度
   - ITスキル別満足度
   - ANOVA検定
    ↓
⑤ IPA分析
   - 4象限分類
   - 改善優先順位決定
    ↓
分析結果（JSON/Excel）
```

---

## 基本分析

### 1. 記述統計

**計算内容:**
```
- 平均値（mean）
- 中央値（median）
- 標準偏差（std）
- 最小値（min）
- 最大値（max）
- 四分位数（Q1, Q3）
- 欠損数（missing_count）
- 有効回答数（valid_count）
```

**対象項目:**
- 満足度評価（8項目）
- 重要度評価（4項目）

**出力例:**
```json
{
  "overall_satisfaction": {
    "mean": 3.2,
    "median": 3.0,
    "std": 1.1,
    "min": 1.0,
    "max": 5.0,
    "q1": 2.0,
    "q3": 4.0,
    "missing_count": 0,
    "valid_count": 90
  }
}
```

---

### 2. 満足度分布

**分析内容:**

各評価値（1-5）の件数と割合を集計します。

**集計項目:**
```
評価値1（非常に不満）: 件数、割合
評価値2（不満）: 件数、割合
評価値3（普通）: 件数、割合
評価値4（満足）: 件数、割合
評価値5（非常に満足）: 件数、割合

満足以上（4-5点）: 件数、割合
不満以下（1-2点）: 件数、割合
```

**出力例:**
```json
{
  "overall_satisfaction_distribution": {
    "1": {"count": 5, "percentage": 5.6},
    "2": {"count": 18, "percentage": 20.0},
    "3": {"count": 35, "percentage": 38.9},
    "4": {"count": 25, "percentage": 27.8},
    "5": {"count": 7, "percentage": 7.8},
    "satisfied": {"count": 32, "percentage": 35.6},
    "dissatisfied": {"count": 23, "percentage": 25.6}
  }
}
```

**可視化:**
- 縦棒グラフ（評価値別の件数）
- 色分け: 1-2（赤）、3（黄）、4-5（緑）

---

### 3. 信頼区間の計算

**計算式:**
```
信頼区間下限 = 平均値 - Z × 標準誤差
信頼区間上限 = 平均値 + Z × 標準誤差

標準誤差 = 標準偏差 ÷ √n

Z値（95%信頼水準）= 1.96
```

**計算例:**
```
総合満足度:
- 平均値: 3.2
- 標準偏差: 1.1
- サンプルサイズ: 90

標準誤差 = 1.1 ÷ √90 = 0.116
誤差範囲 = 1.96 × 0.116 = 0.227

信頼区間下限 = 3.2 - 0.227 = 2.97
信頼区間上限 = 3.2 + 0.227 = 3.43

→ 総合満足度は3.2点（95%信頼区間: 2.97～3.43点）
```

**出力例:**
```json
{
  "overall_satisfaction_ci": {
    "mean": 3.2,
    "std": 1.1,
    "n": 90,
    "confidence_level": 0.95,
    "standard_error": 0.116,
    "margin_of_error": 0.227,
    "ci_lower": 2.97,
    "ci_upper": 3.43
  }
}
```

**報告例:**
```
総合満足度は3.2点（95%信頼区間: 2.97～3.43点）
```

---

## 総合満足度の算出

### 方法1: 直接測定法（推奨）

**定義:**
アンケートの「総合満足度」項目（質問8）の回答をそのまま使用します。

**計算:**
```python
総合満足度 = overall_satisfaction列の平均値
```

**メリット:**
- 回答者の直感的な総合判断を反映
- 算出が簡単
- 他の項目との独立性を保持

**算出例:**
```
総合満足度: 3.2点（5点満点）
```

---

### 方法2: 単純平均法

**定義:**
各満足度項目の単純平均を総合満足度とします。

**計算式:**
```
総合満足度 = Σ(各項目の満足度) ÷ 項目数
```

**対象項目（7項目）:**
1. 対応スピード
2. 技術的解決力
3. 説明のわかりやすさ
4. 対応の丁寧さ
5. システム安定性
6. セキュリティ対策
7. 新システム導入支援

**算出例:**
```
項目                 | 満足度
--------------------|-------
対応スピード         | 2.8
技術的解決力         | 3.4
説明のわかりやすさ   | 2.9
対応の丁寧さ         | 3.3
システム安定性       | 3.1
セキュリティ対策     | 3.5
新システム導入支援   | 3.2
--------------------|-------
合計                | 22.2
項目数              | 7

総合満足度 = 22.2 ÷ 7 = 3.17
```

**メリット:**
- 全項目を等しく重視
- 算出が簡単で再現性が高い

**デメリット:**
- 重要度の違いを考慮しない

---

### 方法3: 重要度加重平均法（最も精緻）

**定義:**
各項目の満足度を重要度で重み付けして平均を算出します。

**計算式:**
```
総合満足度 = Σ(各項目の満足度 × 重要度) ÷ Σ(重要度)
```

**算出例:**

| 項目 | 満足度 | 重要度 | 重み付け値 |
|------|--------|--------|------------|
| 対応スピード | 2.8 | 4.2 | 11.76 |
| 技術的解決力 | 3.4 | 4.0 | 13.60 |
| 説明のわかりやすさ | 2.9 | 4.0 | 11.60 |
| 対応の丁寧さ | 3.3 | 3.5 | 11.55 |
| システム安定性 | 3.1 | 3.9 | 12.09 |
| セキュリティ対策 | 3.5 | 3.7 | 12.95 |
| 新システム導入支援 | 3.2 | 3.4 | 10.88 |

```
重み付け値合計: 84.43
重要度合計: 26.7

総合満足度 = 84.43 ÷ 26.7 = 3.16
```

**メリット:**
- 重要度の高い項目を重視
- 戦略的な判断に適している

**デメリット:**
- 計算がやや複雑
- 重要度の測定が必要

---

### 3手法の比較

**出力例:**
```json
{
  "overall_satisfaction_comparison": {
    "direct": {
      "value": 3.20,
      "method": "直接測定法",
      "description": "アンケート項目「総合満足度」の平均"
    },
    "simple_average": {
      "value": 3.17,
      "method": "単純平均法",
      "description": "7項目の満足度の単純平均"
    },
    "weighted_average": {
      "value": 3.16,
      "method": "重要度加重平均法",
      "description": "重要度で重み付けした平均"
    },
    "recommended": "direct"
  }
}
```

**推奨アプローチ:**
```
主指標: 直接測定法（3.20点）
副指標: 重要度加重平均法（3.16点）
参考: 単純平均法（3.17点）
```

---

## 相関分析

### 1. 総合満足度との相関

**目的:**
どの項目が総合満足度に最も影響するかを特定します。

**計算:**
ピアソン相関係数（r）を算出します。

```
r = Cov(X, Y) / (σ_X × σ_Y)

Where:
Cov(X, Y): XとYの共分散
σ_X, σ_Y: XとYの標準偏差
```

**解釈:**
```
|r| = 0.0 - 0.2  : ほとんど相関なし
|r| = 0.2 - 0.4  : 弱い相関
|r| = 0.4 - 0.7  : 中程度の相関
|r| = 0.7 - 1.0  : 強い相関
```

**分析例:**
```
項目                 | 相関係数 | p値    | 解釈
--------------------|---------|--------|------------------
対応スピード         | 0.72    | <0.001 | 強い正の相関***
技術的解決力         | 0.68    | <0.001 | 中程度の正の相関***
説明のわかりやすさ   | 0.65    | <0.001 | 中程度の正の相関***
対応の丁寧さ         | 0.61    | <0.001 | 中程度の正の相関***
システム安定性       | 0.58    | <0.001 | 中程度の正の相関***
セキュリティ対策     | 0.52    | <0.001 | 中程度の正の相関***
新システム導入支援   | 0.55    | <0.001 | 中程度の正の相関***

***: p < 0.001（高度に有意）
```

**結論:**
- 対応スピードが総合満足度に最も強く影響（r=0.72）
- 全項目が総合満足度と有意な正の相関を持つ

---

### 2. 相関行列

**目的:**
満足度項目間の関係性を網羅的に把握します。

**出力例:**
```
         Q8   Q9   Q10  Q11  Q12  Q13  Q14  Q15
Q8(総合) 1.00 0.72 0.68 0.65 0.61 0.58 0.52 0.55
Q9(速度) 0.72 1.00 0.58 0.62 0.59 0.51 0.48 0.50
Q10(技術)0.68 0.58 1.00 0.71 0.55 0.63 0.58 0.60
Q11(説明)0.65 0.62 0.71 1.00 0.68 0.52 0.49 0.51
Q12(丁寧)0.61 0.59 0.55 0.68 1.00 0.48 0.45 0.47
Q13(安定)0.58 0.51 0.63 0.52 0.48 1.00 0.72 0.58
Q14(セキュ)0.52 0.48 0.58 0.49 0.45 0.72 1.00 0.55
Q15(新規)0.55 0.50 0.60 0.51 0.47 0.58 0.55 1.00
```

**可視化:**
- ヒートマップ（色の濃淡で相関の強さを表現）

**解釈:**
```
適切な相関範囲: 0.30 ～ 0.90
- 相関が高すぎる (>0.90): 重複質問の可能性
- 相関が低すぎる (<0.30): 測定対象が異なる可能性

結果: 全項目が適切な範囲（0.45 ～ 0.72）✓
```

---

## 属性別分析

### 1. 属性別の記述統計

**分析対象:**
- 部署別
- 職位別
- 勤続年数別
- ITスキル別

**集計内容:**
```
各属性グループの:
- 平均値
- 標準偏差
- サンプルサイズ
- 95%信頼区間
```

**出力例（部署別）:**
```
部署    | 平均値 | 標準偏差 | 人数 | 95%CI下限 | 95%CI上限
--------|--------|----------|------|-----------|----------
営業部  | 3.1    | 1.0      | 24   | 2.7       | 3.5
製造部  | 2.8    | 1.2      | 39   | 2.4       | 3.2
管理部  | 3.4    | 0.9      | 18   | 3.0       | 3.8
人事部  | 3.2    | 1.1      | 8    | 2.4       | 4.0
その他  | 3.3    | 1.0      | 1    | -         | -
```

---

### 2. 属性別の記述統計比較

**分析対象:**
- 部署別
- 職位別
- 勤続年数別
- ITスキル別

**集計内容:**
```
各属性グループの:
- 平均値
- 標準偏差
- サンプルサイズ
- 95%信頼区間
- グループ間の差異
```

**出力例（部署別）:**
```
部署    | 平均値 | 標準偏差 | 人数 | 95%CI下限 | 95%CI上限
--------|--------|----------|------|-----------|----------
営業部  | 3.1    | 1.0      | 24   | 2.7       | 3.5
製造部  | 2.8    | 1.2      | 39   | 2.4       | 3.2
管理部  | 3.4    | 0.9      | 18   | 3.0       | 3.8
人事部  | 3.2    | 1.1      | 8    | 2.4       | 4.0
その他  | 3.3    | 1.0      | 1    | -         | -
```

**グループ間の比較:**
```
最高: 管理部（3.4点）
最低: 製造部（2.8点）
差異: 0.6点

観察:
- 管理部が最も高い満足度
- 製造部が最も低い満足度
- 部署により満足度に差がある
```

---

### 3. ITスキル別分析の例

**記述統計:**
```
スキル  | 平均値 | 標準偏差 | 人数
--------|--------|----------|------
初心者  | 2.5    | 1.2      | 16
基本的  | 3.0    | 1.0      | 32
中級    | 3.3    | 0.9      | 30
上級    | 3.6    | 0.8      | 10
専門的  | 3.8    | 0.7      | 2
```

**傾向分析:**
```
観察される傾向:
- ITスキルが高いほど満足度が高い
- 初心者と上級者で1.1点の差
- スキルレベルと満足度に正の相関

示唆:
- スキル別のサポート体制が必要
- 初心者向けの説明・サポート強化が急務
- わかりやすい説明資料の充実
```

---

## IPA分析

### 1. IPA分析とは

**定義:**
Importance-Performance Analysis（重要度・満足度分析）

**目的:**
改善の優先順位を明確化するため、重要度と満足度の2軸でマトリックス分析を行います。

---

### 2. 4象限の定義

```
        重要度高
            ↑
    Ⅱ最優先改善 | Ⅰ維持エリア
    ------------|-------------
    Ⅲ改善検討   | Ⅳ過剰品質
            ←
        重要度低
        
        満足度低 → 満足度高
```

**各象限の意味:**

**第Ⅰ象限（維持エリア）:**
```
重要度: 高
満足度: 高
対応: 現状を維持・強化
優先度: 中
```

**第Ⅱ象限（最優先改善エリア）:**
```
重要度: 高
満足度: 低
対応: 最優先で改善が必要
優先度: 最高
```

**第Ⅲ象限（改善検討エリア）:**
```
重要度: 低
満足度: 低
対応: 余裕があれば改善
優先度: 低
```

**第Ⅳ象限（過剰品質エリア）:**
```
重要度: 低
満足度: 高
対応: リソースの再配分を検討
優先度: 低
```

---

### 3. 分析データの準備

**対象項目:**

満足度項目と対応する重要度項目のペア:
1. 対応スピード ⇔ 対応スピードの重要度
2. 技術的解決力 ⇔ 技術的解決力の重要度
3. 説明のわかりやすさ ⇔ 説明のわかりやすさの重要度
4. 対応の丁寧さ ⇔ 対応の丁寧さの重要度

**データ例:**
```
項目                 | 重要度 | 満足度
--------------------|--------|-------
対応スピード         | 4.2    | 2.8
技術的解決力         | 4.0    | 3.4
説明のわかりやすさ   | 4.0    | 2.9
対応の丁寧さ         | 3.5    | 3.3
システム安定性       | 3.9    | 3.1
セキュリティ対策     | 3.7    | 3.5
新システム導入支援   | 3.4    | 3.2
```

---

### 4. 中央値の計算

**満足度の中央値:**
```
データ: 2.8, 3.4, 2.9, 3.3, 3.1, 3.5, 3.2
ソート: 2.8, 2.9, 3.1, 3.2, 3.3, 3.4, 3.5

中央値 = 3.2（4番目の値）
```

**重要度の中央値:**
```
データ: 4.2, 4.0, 4.0, 3.5, 3.9, 3.7, 3.4
ソート: 3.4, 3.5, 3.7, 3.9, 4.0, 4.0, 4.2

中央値 = 3.9（4番目の値）
```

**分割基準:**
```
満足度: 3.2以上 = 高、3.2未満 = 低
重要度: 3.9以上 = 高、3.9未満 = 低
```

---

### 5. 象限分類

**判定ロジック:**
```python
if 重要度 >= 3.9 and 満足度 >= 3.2:
    象限 = "Ⅰ（維持エリア）"
elif 重要度 >= 3.9 and 満足度 < 3.2:
    象限 = "Ⅱ（最優先改善エリア）"
elif 重要度 < 3.9 and 満足度 < 3.2:
    象限 = "Ⅲ（改善検討エリア）"
else:
    象限 = "Ⅳ（過剰品質エリア）"
```

**分類結果:**
```
項目                 | 重要度 | 満足度 | 象限
--------------------|--------|--------|------
対応スピード         | 4.2    | 2.8    | Ⅱ
技術的解決力         | 4.0    | 3.4    | Ⅰ
説明のわかりやすさ   | 4.0    | 2.9    | Ⅱ
対応の丁寧さ         | 3.5    | 3.3    | Ⅳ
システム安定性       | 3.9    | 3.1    | Ⅲ
セキュリティ対策     | 3.7    | 3.5    | Ⅳ
新システム導入支援   | 3.4    | 3.2    | Ⅲ
```

---

### 6. 改善優先順位の決定

**第Ⅱ象限（最優先改善）:**
```
1. 対応スピード（重要度4.2、満足度2.8）
   ギャップ: 1.4点
   
2. 説明のわかりやすさ（重要度4.0、満足度2.9）
   ギャップ: 1.1点
```

**改善目標の設定:**
```
対応スピード:
  現状: 2.8点
  目標: 3.5点（+0.7点）
  期限: 3ヶ月

説明のわかりやすさ:
  現状: 2.9点
  目標: 3.6点（+0.7点）
  期限: 6ヶ月
```

---

### 7. 出力データ構造

**JSON出力例:**
```json
{
  "ipa_analysis": {
    "settings": {
      "satisfaction_median": 3.2,
      "importance_median": 3.9,
      "split_method": "median"
    },
    "items": {
      "対応スピード": {
        "satisfaction": 2.8,
        "importance": 4.2,
        "gap": 1.4,
        "quadrant": "Ⅱ",
        "quadrant_name": "最優先改善エリア",
        "priority": 1
      },
      "説明のわかりやすさ": {
        "satisfaction": 2.9,
        "importance": 4.0,
        "gap": 1.1,
        "quadrant": "Ⅱ",
        "quadrant_name": "最優先改善エリア",
        "priority": 2
      },
      "技術的解決力": {
        "satisfaction": 3.4,
        "importance": 4.0,
        "gap": 0.6,
        "quadrant": "Ⅰ",
        "quadrant_name": "維持エリア",
        "priority": null
      }
    },
    "summary": {
      "quadrant_Ⅰ": ["技術的解決力"],
      "quadrant_Ⅱ": ["対応スピード", "説明のわかりやすさ"],
      "quadrant_Ⅲ": ["システム安定性", "新システム導入支援"],
      "quadrant_Ⅳ": ["対応の丁寧さ", "セキュリティ対策"]
    }
  }
}
```

---

## 出力データの構造

### 分析結果ファイル（JSON）

**ファイル構成:**
```
out/analysis_results.json
├─ basic_statistics
│  ├─ descriptive_stats
│  ├─ satisfaction_distribution
│  └─ confidence_intervals
├─ overall_satisfaction
│  ├─ direct
│  ├─ simple_average
│  └─ weighted_average
├─ correlation_analysis
│  ├─ with_overall_satisfaction
│  └─ correlation_matrix
├─ attribute_analysis
│  ├─ by_department
│  ├─ by_position
│  ├─ by_years_of_service
│  └─ by_it_skill_level
└─ ipa_analysis
   ├─ settings
   ├─ items
   └─ summary
```

---

### レポートファイル（複数形式）

**テキストレポート:**
```
out/reports/executive_summary.txt
out/reports/detailed_report.md
```

**グラフファイル:**
```
out/reports/graphs/
├─ satisfaction_distribution.png
├─ satisfaction_ranking.png
├─ correlation_heatmap.png
├─ attribute_comparison_department.png
├─ attribute_comparison_skill.png
└─ ipa_matrix.png
```

**統合レポート:**
```
out/reports/interactive_report.html
out/reports/final_report.pdf
```

---

## まとめ

### 分析の効果

1. **現状の可視化**
   - 満足度の定量的把握
   - 信頼区間による精度の明示

2. **因果関係の解明**
   - 相関分析による影響要因の特定
   - 属性別分析による差異の発見

3. **戦略的意思決定**
   - IPA分析による改善優先順位の明確化
   - データに基づく資源配分の最適化

4. **継続的改善**
   - ベースラインの設定
   - 経年変化のトラッキング

### 出力されるファイル

- `out/analysis_results.json`: 全分析結果（詳細データ）
- `out/reports/`: 各種レポート・グラフ

分析の詳細な設定は `config/config.yaml` で定義されています。
